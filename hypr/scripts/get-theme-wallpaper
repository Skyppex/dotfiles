#!/usr/bin/nu

let themes = "~/.config/themes" | path expand
let current = open ($themes | path join "current.toml")
let theme = $themes | path join $current.dir
let images = $theme | path join "images"
let config = open ($theme | path join "config.toml")
let metadata = open ($theme | path join "metadata.toml")
let variant = $config.variant

let file = ls $images 
| get name 
| path basename 
| each { |it|
    let index_colon = $it | str index-of ":"
    let index_dot = $it | str index-of "."
    let tags = $it 
    | str substring ($index_colon + 1)..($index_dot - 1) 
    | split row "-"
    { file: $it, tags: $tags }
}
| where (($it.tags | length) == 1)
| where (($it.tags | first) == $variant)
| get file
| first

$images | path join $file | path expand
