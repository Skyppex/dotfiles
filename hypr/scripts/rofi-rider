#!/usr/bin/env nu

let results = fd -t f -e sln . $env.CODE

if ($results | is-empty) {
    notify-send "no solutions found"
    return
}

let prefix_length = $env.CODE | str length

let map = $results
| lines
| each {|it|
    {
        full: $it,
        stripped: ($it 
            | str substring ($prefix_length + 1)..
            | path dirname
        )
    }
}

let selected = $map | get stripped | to text | rofi -case-smart -dmenu -p "select solution"

if ($selected | is-empty) {
    notify-send "no solution selected"
    return
}

let full = $map | where { |it| $it.stripped == $selected } | first | get full

rider $full
